<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Principal's Dilemma - Interactive Moral Hazard Simulation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.95;
        }

        .content {
            padding: 40px;
        }

        .stage {
            display: none;
            animation: fadeIn 0.5s;
        }

        .stage.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .intro-section {
            text-align: center;
            padding: 40px 20px;
        }

        .intro-section h2 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 20px;
        }

        .intro-section p {
            font-size: 1.1em;
            line-height: 1.8;
            margin-bottom: 15px;
            color: #555;
        }

        .scenario-box {
            background: #f8f9ff;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin: 30px 0;
            border-radius: 8px;
        }

        .scenario-box h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .control-group {
            margin-bottom: 35px;
        }

        .control-group label {
            display: block;
            font-size: 1.1em;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        .control-group .description {
            font-size: 0.95em;
            color: #666;
            margin-bottom: 15px;
        }

        .slider-container {
            position: relative;
            padding: 10px 0;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.4);
        }

        input[type="range"]::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
        }

        .slider-value {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            margin-top: 10px;
            font-size: 1.1em;
        }

        .radio-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .radio-option {
            flex: 1;
            min-width: 120px;
        }

        .radio-option input[type="radio"] {
            display: none;
        }

        .radio-option label {
            display: block;
            padding: 15px;
            background: #f0f0f0;
            border: 2px solid #ddd;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
            font-weight: 500;
        }

        .radio-option input[type="radio"]:checked + label {
            background: #667eea;
            color: white;
            border-color: #667eea;
            transform: scale(1.05);
        }

        .radio-option label:hover {
            border-color: #667eea;
        }

        .cost-indicator {
            display: inline-block;
            font-size: 0.9em;
            color: #e74c3c;
            font-weight: 600;
            margin-top: 5px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 16px 40px;
            font-size: 1.2em;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            transition: all 0.3s;
            display: inline-block;
            margin-top: 20px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-center {
            text-align: center;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e0e0e0;
            border-radius: 10px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s;
            border-radius: 10px;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .result-card {
            background: linear-gradient(135deg, #f5f7ff 0%, #e8ecff 100%);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid #e0e5ff;
        }

        .result-card .metric-value {
            font-size: 2.5em;
            font-weight: 700;
            color: #667eea;
            margin: 10px 0;
        }

        .result-card .metric-label {
            font-size: 1em;
            color: #666;
            font-weight: 500;
        }

        .gauge-container {
            width: 200px;
            height: 200px;
            margin: 30px auto;
            position: relative;
        }

        .gauge {
            width: 100%;
            height: 100%;
        }

        .gauge-score {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3em;
            font-weight: 700;
            color: #667eea;
        }

        .diagnosis-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 25px;
            margin: 30px 0;
            border-radius: 8px;
        }

        .diagnosis-box.danger {
            background: #f8d7da;
            border-left-color: #dc3545;
        }

        .diagnosis-box.success {
            background: #d4edda;
            border-left-color: #28a745;
        }

        .diagnosis-box h3 {
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        .diagnosis-box ul {
            list-style: none;
            padding-left: 0;
        }

        .diagnosis-box li {
            padding: 8px 0;
            font-size: 1.05em;
            line-height: 1.6;
        }

        .diagnosis-box li:before {
            content: "‚ö†Ô∏è ";
            margin-right: 8px;
        }

        .diagnosis-box.success li:before {
            content: "‚úÖ ";
        }

        .comparison-table {
            margin: 30px 0;
            overflow-x: auto;
        }

        .comparison-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .comparison-table th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }

        .comparison-table tr:hover {
            background: #f5f7ff;
        }

        .highlight {
            background: #fff3cd;
            font-weight: 600;
        }

        .email-capture {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 15px;
            margin: 30px 0;
            text-align: center;
        }

        .email-capture h3 {
            font-size: 1.8em;
            margin-bottom: 15px;
        }

        .email-capture p {
            font-size: 1.1em;
            margin-bottom: 25px;
            opacity: 0.95;
        }

        .email-capture input[type="email"] {
            padding: 15px 20px;
            font-size: 1.1em;
            border: none;
            border-radius: 50px;
            width: 100%;
            max-width: 400px;
            margin-right: 10px;
            outline: none;
        }

        .email-capture .btn {
            background: white;
            color: #667eea;
            margin-top: 15px;
        }

        .email-capture .btn:hover {
            background: #f0f0f0;
        }

        .bar-chart {
            margin: 30px 0;
        }

        .bar-item {
            margin-bottom: 20px;
        }

        .bar-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .bar-visual {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        .bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            transition: width 1s ease-out;
            display: flex;
            align-items: center;
            padding: 0 15px;
            color: white;
            font-weight: 600;
        }

        .loading {
            text-align: center;
            padding: 60px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .concept-explainer {
            background: #f8f9ff;
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
        }

        .concept-explainer h3 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.6em;
        }

        .concept-explainer p {
            line-height: 1.8;
            margin-bottom: 15px;
            font-size: 1.05em;
        }

        .cta-section {
            text-align: center;
            padding: 40px;
            background: linear-gradient(135deg, #f5f7ff 0%, #e8ecff 100%);
            border-radius: 15px;
            margin-top: 40px;
        }

        .cta-section h3 {
            color: #667eea;
            font-size: 1.8em;
            margin-bottom: 15px;
        }

        .cta-section p {
            font-size: 1.1em;
            margin-bottom: 25px;
            color: #555;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .content {
                padding: 20px;
            }
            
            .radio-group {
                flex-direction: column;
            }
            
            .radio-option {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ The Principal's Dilemma</h1>
            <p>Can You Design Incentives That Actually Work?</p>
        </div>

        <div class="content">
            <!-- Progress Bar -->
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar" style="width: 0%"></div>
            </div>

            <!-- STAGE 0: Introduction -->
            <div class="stage active" id="stage0">
                <div class="intro-section">
                    <h2>Welcome, CEO! üëî</h2>
                    <p>You've just been appointed CEO of a growing tech company with 50 engineers. Your board has one simple goal: <strong>maximize productivity</strong>.</p>
                    
                    <div class="scenario-box">
                        <h3>üéÆ Your Challenge</h3>
                        <p>Design a compensation and monitoring system that gets the best from your team. But here's the catch: <strong>you can't directly observe how hard they work</strong>.</p>
                        <p>Will your choices create alignment... or moral hazard?</p>
                    </div>

                    <p>This interactive simulation will reveal how incentive design shapes hidden behaviors in your organization.</p>
                    <p><strong>Takes 3 minutes. Could save you millions.</strong></p>

                    <div class="btn-center">
                        <button class="btn" onclick="nextStage(1)">Start Simulation ‚Üí</button>
                    </div>
                </div>
            </div>

            <!-- STAGE 1: Compensation Design -->
            <div class="stage" id="stage1">
                <h2 style="color: #667eea; margin-bottom: 30px;">üí∞ Step 1: Design Your Compensation</h2>

                <div class="control-group">
                    <label>Base Salary per Engineer</label>
                    <div class="description">Higher salaries attract better talent but increase fixed costs</div>
                    <div class="slider-container">
                        <input type="range" id="baseSalary" min="60000" max="120000" step="5000" value="80000" oninput="updateSliderValue('baseSalary', '‚Ç¨', 'K')">
                        <div class="slider-value" id="baseSalaryValue">‚Ç¨80K</div>
                    </div>
                </div>

                <div class="control-group">
                    <label>Performance Bonus (% of Base)</label>
                    <div class="description">Variable pay tied to outcomes - but outcomes depend on effort AND luck</div>
                    <div class="slider-container">
                        <input type="range" id="bonus" min="0" max="50" step="5" value="15" oninput="updateSliderValue('bonus', '', '%')">
                        <div class="slider-value" id="bonusValue">15%</div>
                    </div>
                </div>

                <div class="control-group">
                    <label>Equity/Stock Options</label>
                    <div class="description">Long-term alignment through ownership</div>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="equity1" name="equity" value="none" checked>
                            <label for="equity1">None<br><span class="cost-indicator">‚Ç¨0</span></label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="equity2" name="equity" value="standard">
                            <label for="equity2">Standard<br><span class="cost-indicator">‚Ç¨10K/year</span></label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="equity3" name="equity" value="generous">
                            <label for="equity3">Generous<br><span class="cost-indicator">‚Ç¨25K/year</span></label>
                        </div>
                    </div>
                </div>

                <div class="btn-center">
                    <button class="btn" onclick="nextStage(2)">Continue to Monitoring ‚Üí</button>
                </div>
            </div>

            <!-- STAGE 2: Monitoring Design -->
            <div class="stage" id="stage2">
                <h2 style="color: #667eea; margin-bottom: 30px;">üîç Step 2: Choose Your Monitoring Strategy</h2>

                <div class="control-group">
                    <label>Code Review Intensity</label>
                    <div class="description">More reviews catch issues but cost time and money</div>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="review1" name="codeReview" value="none" checked>
                            <label for="review1">None<br><span class="cost-indicator">‚Ç¨0</span></label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="review2" name="codeReview" value="light">
                            <label for="review2">Light<br><span class="cost-indicator">‚Ç¨5K/year</span></label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="review3" name="codeReview" value="moderate">
                            <label for="review3">Moderate<br><span class="cost-indicator">‚Ç¨10K/year</span></label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="review4" name="codeReview" value="strict">
                            <label for="review4">Strict<br><span class="cost-indicator">‚Ç¨15K/year</span></label>
                        </div>
                    </div>
                </div>

                <div class="control-group">
                    <label>Time Tracking System</label>
                    <div class="description">Track hours worked vs. actual output</div>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="time1" name="timeTracking" value="no" checked>
                            <label for="time1">No Tracking<br><span class="cost-indicator">‚Ç¨0</span></label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="time2" name="timeTracking" value="yes">
                            <label for="time2">Full Tracking<br><span class="cost-indicator">‚Ç¨5K/year</span></label>
                        </div>
                    </div>
                </div>

                <div class="control-group">
                    <label>1-on-1 Meeting Frequency</label>
                    <div class="description">Direct communication to understand effort and challenges</div>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="meeting1" name="meetings" value="monthly" checked>
                            <label for="meeting1">Monthly<br><span class="cost-indicator">Low cost</span></label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="meeting2" name="meetings" value="biweekly">
                            <label for="meeting2">Bi-weekly<br><span class="cost-indicator">Medium cost</span></label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="meeting3" name="meetings" value="weekly">
                            <label for="meeting3">Weekly<br><span class="cost-indicator">High cost</span></label>
                        </div>
                    </div>
                </div>

                <div class="btn-center">
                    <button class="btn" onclick="nextStage(3)">Continue to Culture ‚Üí</button>
                </div>
            </div>

            <!-- STAGE 3: Culture & Pressure -->
            <div class="stage" id="stage3">
                <h2 style="color: #667eea; margin-bottom: 30px;">‚ö° Step 3: Define Your Culture</h2>

                <div class="control-group">
                    <label>Deadline Pressure</label>
                    <div class="description">How aggressive are your timelines?</div>
                    <div class="slider-container">
                        <input type="range" id="pressure" min="1" max="3" step="1" value="2" oninput="updatePressureLabel()">
                        <div class="slider-value" id="pressureValue">Balanced</div>
                    </div>
                </div>

                <div class="control-group">
                    <label>Quality Standards</label>
                    <div class="description">What's your tolerance for technical debt?</div>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="quality1" name="quality" value="minimum">
                            <label for="quality1">Ship Fast<br><small>Move fast, fix later</small></label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="quality2" name="quality" value="standard" checked>
                            <label for="quality2">Balanced<br><small>Quality matters</small></label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="quality3" name="quality" value="exceptional">
                            <label for="quality3">Excellence<br><small>No compromises</small></label>
                        </div>
                    </div>
                </div>

                <div class="control-group">
                    <label>Team Autonomy</label>
                    <div class="description">How much freedom do engineers have in decision-making?</div>
                    <div class="slider-container">
                        <input type="range" id="autonomy" min="1" max="3" step="1" value="2" oninput="updateAutonomyLabel()">
                        <div class="slider-value" id="autonomyValue">Moderate</div>
                    </div>
                </div>

                <div class="btn-center">
                    <button class="btn" onclick="runSimulation()">Run Simulation ‚Üí</button>
                </div>
            </div>

            <!-- STAGE 4: Processing -->
            <div class="stage" id="stage4">
                <div class="loading">
                    <div class="spinner"></div>
                    <h2 style="color: #667eea;">Simulating 12 Months of Operations...</h2>
                    <p style="margin-top: 20px; color: #666; font-size: 1.1em;" id="loadingText">Analyzing agent behavior...</p>
                </div>
            </div>

            <!-- STAGE 5: Results -->
            <div class="stage" id="stage5">
                <h2 style="color: #667eea; margin-bottom: 30px; text-align: center;">üìä Your Results</h2>

                <!-- Productivity Score Gauge -->
                <div class="gauge-container">
                    <svg class="gauge" viewBox="0 0 200 120">
                        <path d="M 20 100 A 80 80 0 0 1 180 100" 
                              fill="none" 
                              stroke="#e0e0e0" 
                              stroke-width="20" 
                              stroke-linecap="round"/>
                        <path id="gaugeArc" 
                              d="M 20 100 A 80 80 0 0 1 180 100" 
                              fill="none" 
                              stroke-width="20" 
                              stroke-linecap="round"
                              stroke-dasharray="251.2"
                              stroke-dashoffset="251.2"
                              style="transition: stroke-dashoffset 2s ease-out, stroke 2s ease-out"/>
                    </svg>
                    <div class="gauge-score" id="gaugeScore">0</div>
                </div>

                <h3 style="text-align: center; color: #667eea; margin-bottom: 30px;">Productivity Score</h3>

                <!-- Key Metrics -->
                <div class="results-grid">
                    <div class="result-card">
                        <div class="metric-label">Effort Level</div>
                        <div class="metric-value" id="effortMetric">--</div>
                        <div class="metric-label">Hidden from you</div>
                    </div>
                    <div class="result-card">
                        <div class="metric-label">Risk-Taking</div>
                        <div class="metric-value" id="riskMetric">--</div>
                        <div class="metric-label">Corner-cutting</div>
                    </div>
                    <div class="result-card">
                        <div class="metric-label">Turnover Risk</div>
                        <div class="metric-value" id="turnoverMetric">--</div>
                        <div class="metric-label">Employee attrition</div>
                    </div>
                </div>

                <!-- Financial Impact -->
                <div class="bar-chart">
                    <h3 style="color: #667eea; margin-bottom: 20px;">üí∞ Financial Impact (Annual)</h3>
                    
                    <div class="bar-item">
                        <div class="bar-label">
                            <span>Gross Output</span>
                            <span id="grossOutput">‚Ç¨0</span>
                        </div>
                        <div class="bar-visual">
                            <div class="bar-fill" id="grossBar" style="width: 0%"></div>
                        </div>
                    </div>

                    <div class="bar-item">
                        <div class="bar-label">
                            <span>Salary Costs</span>
                            <span id="salaryCosts">‚Ç¨0</span>
                        </div>
                        <div class="bar-visual">
                            <div class="bar-fill" id="salaryBar" style="width: 0%; background: #e74c3c;"></div>
                        </div>
                    </div>

                    <div class="bar-item">
                        <div class="bar-label">
                            <span>Monitoring Costs</span>
                            <span id="monitoringCosts">‚Ç¨0</span>
                        </div>
                        <div class="bar-visual">
                            <div class="bar-fill" id="monitoringBar" style="width: 0%; background: #f39c12;"></div>
                        </div>
                    </div>

                    <div class="bar-item">
                        <div class="bar-label">
                            <span>‚ö†Ô∏è Hidden Costs (Technical Debt + Turnover)</span>
                            <span id="hiddenCosts">‚Ç¨0</span>
                        </div>
                        <div class="bar-visual">
                            <div class="bar-fill" id="hiddenBar" style="width: 0%; background: #e74c3c;"></div>
                        </div>
                    </div>

                    <div class="bar-item" style="margin-top: 20px;">
                        <div class="bar-label" style="font-size: 1.2em;">
                            <span><strong>Net Productivity Value</strong></span>
                            <span id="netValue" style="color: #667eea;"><strong>‚Ç¨0</strong></span>
                        </div>
                    </div>
                </div>

                <!-- Diagnosis -->
                <div class="diagnosis-box" id="diagnosisBox">
                    <h3 id="diagnosisTitle">üîç Diagnosis</h3>
                    <p id="diagnosisText"></p>
                    <ul id="diagnosisList"></ul>
                </div>

                <!-- Comparison -->
                <div class="comparison-table">
                    <h3 style="color: #667eea; margin-bottom: 20px;">üìà How You Compare</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Metric</th>
                                <th>Your Design</th>
                                <th>Optimal Design</th>
                                <th>Industry Average</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="highlight">
                                <td><strong>Productivity Score</strong></td>
                                <td id="compYourScore">--</td>
                                <td>89/100</td>
                                <td>71/100</td>
                            </tr>
                            <tr>
                                <td>Net Value Created</td>
                                <td id="compYourValue">--</td>
                                <td>‚Ç¨3.2M</td>
                                <td>‚Ç¨2.1M</td>
                            </tr>
                            <tr>
                                <td>Hidden Cost Ratio</td>
                                <td id="compYourHidden">--</td>
                                <td>8%</td>
                                <td>18%</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="btn-center">
                    <button class="btn" onclick="nextStage(6)">Understand What Happened ‚Üí</button>
                </div>
            </div>

            <!-- STAGE 6: Learning -->
            <div class="stage" id="stage6">
                <div class="concept-explainer">
                    <h3>üß† What Just Happened? Understanding Moral Hazard</h3>
                    
                    <p><strong>Moral hazard</strong> occurs when one party (the agent) takes hidden actions that affect outcomes for another party (the principal) who cannot directly observe those actions.</p>

                    <p>In your simulation:</p>
                    <ul style="padding-left: 20px; margin: 20px 0;">
                        <li style="margin: 10px 0;"><strong>You (Principal)</strong>: Set compensation and monitoring rules</li>
                        <li style="margin: 10px 0;"><strong>Engineers (Agents)</strong>: Chose how much effort to exert and how much risk to take</li>
                        <li style="margin: 10px 0;"><strong>The Problem</strong>: You can't see their actual effort, only final outcomes</li>
                    </ul>

                    <div style="background: white; padding: 20px; border-radius: 10px; margin: 20px 0;">
                        <h4 style="color: #667eea; margin-bottom: 15px;">The Mechanism:</h4>
                        <p><strong>Low Incentives ‚Üí</strong> Engineers exert minimal effort because they're paid the same regardless</p>
                        <p><strong>No Monitoring ‚Üí</strong> Corner-cutting goes undetected, technical debt accumulates</p>
                        <p><strong>High Pressure + Low Quality Standards ‚Üí</strong> Engineers take hidden risks to meet deadlines</p>
                        <p><strong>Result:</strong> Productivity appears acceptable in the short term, but hidden costs explode</p>
                    </div>

                    <h4 style="color: #667eea; margin: 20px 0 15px 0;">Your Specific Issues:</h4>
                    <div id="yourIssues"></div>

                    <div style="background: #d4edda; padding: 20px; border-radius: 10px; margin: 30px 0; border-left: 4px solid #28a745;">
                        <h4 style="color: #28a745; margin-bottom: 15px;">üí° The Fix:</h4>
                        <ul style="padding-left: 20px;">
                            <li style="margin: 10px 0;">Align incentives with true outcomes (not just outputs)</li>
                            <li style="margin: 10px 0;">Use strategic monitoring at leverage points</li>
                            <li style="margin: 10px 0;">Build culture that makes effort visible and valued</li>
                            <li style="margin: 10px 0;">Balance short-term pressure with long-term quality</li>
                        </ul>
                    </div>
                </div>

                <div class="btn-center">
                    <button class="btn" onclick="nextStage(7)">Get Your Custom Report ‚Üí</button>
                </div>
            </div>

            <!-- STAGE 7: Lead Capture -->
            <div class="stage" id="stage7">
                <div class="email-capture">
                    <h3>üìß Want Your Detailed Analysis?</h3>
                    <p>Get a personalized PDF report with:</p>
                    <ul style="list-style: none; padding: 0; margin: 20px 0;">
                        <li style="margin: 10px 0;">‚úÖ Your complete simulation results</li>
                        <li style="margin: 10px 0;">‚úÖ 3-page Incentive Alignment Audit for your industry</li>
                        <li style="margin: 10px 0;">‚úÖ Checklist: "7 Red Flags of Moral Hazard in Your Team"</li>
                        <li style="margin: 10px 0;">‚úÖ Case studies from real organizations</li>
                    </ul>
                    <input type="email" id="emailInput" placeholder="Enter your work email" style="margin-bottom: 10px;">
                    <br>
                    <button class="btn" onclick="captureEmail()">Download My Report</button>
                </div>

                <div class="cta-section">
                    <h3>üöÄ Ready to Fix This in Your Organization?</h3>
                    <p>We help companies detect and eliminate hidden productivity losses from moral hazard.</p>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 30px 0; text-align: left;">
                        <div style="background: white; padding: 20px; border-radius: 10px;">
                            <h4 style="color: #667eea; margin-bottom: 10px;">üí¨ Free Consultation</h4>
                            <p>15-minute call to discuss your actual incentive structure</p>
                        </div>
                        <div style="background: white; padding: 20px; border-radius: 10px;">
                            <h4 style="color: #667eea; margin-bottom: 10px;">üéì Team Workshop</h4>
                            <p>Run this simulation with your leadership team</p>
                        </div>
                        <div style="background: white; padding: 20px; border-radius: 10px;">
                            <h4 style="color: #667eea; margin-bottom: 10px;">üîç Custom Audit</h4>
                            <p>We analyze your organization's hidden costs</p>
                        </div>
                    </div>

                    <button class="btn" onclick="alert('Thank you! In production, this would open a calendar booking link.')">Book Free Consultation</button>
                    <br>
                    <button class="btn" onclick="resetSimulation()" style="background: white; color: #667eea; margin-top: 15px;">üîÑ Try Different Settings</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state - using var for maximum compatibility
        var currentStage = 0;
        var simulationResults = {};

        // Progress tracking
        function updateProgress() {
            var progress = (currentStage / 7) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
        }

        // Stage navigation
        function nextStage(stage) {
            var stages = document.querySelectorAll('.stage');
            for (var i = 0; i < stages.length; i++) {
                stages[i].classList.remove('active');
            }
            document.getElementById('stage' + stage).classList.add('active');
            currentStage = stage;
            updateProgress();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Slider updates
        function updateSliderValue(id, prefix, suffix) {
            var slider = document.getElementById(id);
            var display = document.getElementById(id + 'Value');
            var value = slider.value;
            
            if (suffix === 'K') {
                value = (value / 1000).toFixed(0);
            }
            
            display.textContent = prefix + value + suffix;
        }

        function updatePressureLabel() {
            var value = document.getElementById('pressure').value;
            var labels = ['Relaxed', 'Balanced', 'Aggressive'];
            document.getElementById('pressureValue').textContent = labels[value - 1];
        }

        function updateAutonomyLabel() {
            var value = document.getElementById('autonomy').value;
            var labels = ['Low', 'Moderate', 'High'];
            document.getElementById('autonomyValue').textContent = labels[value - 1];
        }

        // Main simulation logic
        function runSimulation() {
            nextStage(4);
            
            // Collect inputs
            var inputs = {
                baseSalary: parseInt(document.getElementById('baseSalary').value),
                bonus: parseInt(document.getElementById('bonus').value),
                equity: document.querySelector('input[name="equity"]:checked').value,
                codeReview: document.querySelector('input[name="codeReview"]:checked').value,
                timeTracking: document.querySelector('input[name="timeTracking"]:checked').value,
                meetings: document.querySelector('input[name="meetings"]:checked').value,
                pressure: parseInt(document.getElementById('pressure').value),
                quality: document.querySelector('input[name="quality"]:checked').value,
                autonomy: parseInt(document.getElementById('autonomy').value)
            };

            // Simulate loading
            var loadingMessages = [
                "Analyzing agent behavior...",
                "Calculating hidden effort levels...",
                "Simulating risk-taking decisions...",
                "Computing productivity outcomes...",
                "Revealing hidden costs..."
            ];
            
            var msgIndex = 0;
            var msgInterval = setInterval(function() {
                document.getElementById('loadingText').textContent = loadingMessages[msgIndex];
                msgIndex++;
                if (msgIndex >= loadingMessages.length) clearInterval(msgInterval);
            }, 600);

            // Run simulation after 3 seconds
            setTimeout(function() {
                simulationResults = calculateResults(inputs);
                displayResults(simulationResults);
                nextStage(5);
            }, 3000);
        }

        function calculateResults(inputs) {
            // Convert inputs to numerical factors
            var equityMap = { none: 0, standard: 0.15, generous: 0.35 };
            var reviewMap = { none: 0, light: 0.2, moderate: 0.5, strict: 0.8 };
            var meetingMap = { monthly: 0.2, biweekly: 0.4, weekly: 0.6 };
            var qualityMap = { minimum: 0, standard: 0.5, exceptional: 1.0 };

            var equityFactor = equityMap[inputs.equity];
            var reviewFactor = reviewMap[inputs.codeReview];
            var timeTrackingFactor = inputs.timeTracking === 'yes' ? 0.3 : 0;
            var meetingFactor = meetingMap[inputs.meetings];
            var pressureFactor = inputs.pressure / 3;
            var qualityFactor = qualityMap[inputs.quality];
            var autonomyFactor = inputs.autonomy / 3;

            // Calculate monitoring score
            var monitoringScore = (reviewFactor + timeTrackingFactor + meetingFactor) / 2;

            // Calculate incentive strength
            var bonusFactor = inputs.bonus / 50;
            var incentiveScore = (bonusFactor * 0.6 + equityFactor * 0.4);

            // Agent's effort decision
            var baseEffort = 0.3;
            var incentiveEffect = incentiveScore * 0.4;
            var monitoringEffect = monitoringScore * 0.25;
            var autonomyEffect = autonomyFactor * 0.1;
            var effortLevel = Math.min(baseEffort + incentiveEffect + monitoringEffect + autonomyEffect, 1.0);

            // Hidden risk-taking
            var pressureRisk = pressureFactor * 0.4;
            var qualityConstraint = qualityFactor * 0.3;
            var monitoringConstraint = monitoringScore * 0.25;
            var riskTaking = Math.max(0, pressureRisk - qualityConstraint - monitoringConstraint);

            // Burnout factor
            var burnout = Math.max(0, (pressureFactor - 0.5) * 0.3 + (monitoringScore > 0.7 ? 0.2 : 0) - autonomyFactor * 0.1);

            // Productivity outcome
            var productivity = effortLevel * (1 - riskTaking * 0.4 - burnout * 0.3);

            // Financial calculations
            var numEngineers = 50;
            var grossOutput = productivity * 500000 * numEngineers;
            
            var totalSalary = inputs.baseSalary * numEngineers;
            var bonusPayout = (inputs.bonus / 100) * totalSalary * productivity;
            var equityCost = equityFactor * 25000 * numEngineers;
            var salaryCosts = totalSalary + bonusPayout + equityCost;

            var reviewCostMap = { none: 0, light: 5000, moderate: 10000, strict: 15000 };
            var reviewCost = reviewCostMap[inputs.codeReview];
            var timeTrackingCost = inputs.timeTracking === 'yes' ? 5000 : 0;
            var meetingCostMap = { monthly: 10000, biweekly: 20000, weekly: 35000 };
            var meetingCost = meetingCostMap[inputs.meetings];
            var monitoringCosts = reviewCost + timeTrackingCost + meetingCost;

            // Hidden costs
            var technicalDebt = riskTaking * 150000 * numEngineers;
            var turnoverRisk = burnout;
            var turnoverCost = turnoverRisk * inputs.baseSalary * 0.5 * numEngineers;
            var hiddenCosts = technicalDebt + turnoverCost;

            var netValue = grossOutput - salaryCosts - monitoringCosts - hiddenCosts;

            // Productivity score (0-100)
            var productivityScore = Math.round(productivity * 100);

            // Generate diagnosis
            var issues = [];
            if (incentiveScore < 0.3) issues.push("Insufficient outcome-based incentives ‚Üí Low motivation");
            if (monitoringScore < 0.3) issues.push("Blind spots in monitoring ‚Üí Corner-cutting undetected");
            if (riskTaking > 0.3) issues.push("High hidden risk-taking ‚Üí Technical debt accumulation");
            if (burnout > 0.25) issues.push("Burnout risk detected ‚Üí Turnover likely");
            if (pressureFactor > 0.7 && qualityFactor < 0.5) issues.push("Deadline pressure without quality metrics ‚Üí Hidden shortcuts");

            var diagnosisType = 'danger';
            var diagnosisTitle = '‚ö†Ô∏è Significant Moral Hazard Detected';
            var diagnosisText = 'Your incentive design has created misalignment between what you want and what agents are motivated to do.';

            if (productivityScore >= 80) {
                diagnosisType = 'success';
                diagnosisTitle = '‚úÖ Well-Designed Incentive System';
                diagnosisText = 'Your design creates strong alignment. Moral hazard is minimal, though there\'s always room for optimization.';
            } else if (productivityScore >= 60) {
                diagnosisType = 'warning';
                diagnosisTitle = '‚ö†Ô∏è Moderate Moral Hazard Present';
                diagnosisText = 'Your system works, but significant hidden costs are reducing productivity. Some realignment needed.';
            }

            return {
                productivityScore: productivityScore,
                effortLevel: (effortLevel * 100).toFixed(0) + '%',
                riskTaking: (riskTaking * 100).toFixed(0) + '%',
                turnoverRisk: (turnoverRisk * 100).toFixed(0) + '%',
                grossOutput: grossOutput,
                salaryCosts: salaryCosts,
                monitoringCosts: monitoringCosts,
                hiddenCosts: hiddenCosts,
                netValue: netValue,
                hiddenCostRatio: ((hiddenCosts / grossOutput) * 100).toFixed(1) + '%',
                diagnosisType: diagnosisType,
                diagnosisTitle: diagnosisTitle,
                diagnosisText: diagnosisText,
                issues: issues
            };
        }

        function displayResults(results) {
            // Animate gauge
            setTimeout(function() {
                var score = results.productivityScore;
                var arcLength = 251.2;
                var offset = arcLength - (arcLength * score / 100);
                var arc = document.getElementById('gaugeArc');
                arc.style.strokeDashoffset = offset;
                
                // Color based on score
                if (score >= 80) arc.style.stroke = '#28a745';
                else if (score >= 60) arc.style.stroke = '#ffc107';
                else arc.style.stroke = '#dc3545';

                // Animate score number
                animateNumber('gaugeScore', 0, score, 2000);
            }, 100);

            // Display metrics
            document.getElementById('effortMetric').textContent = results.effortLevel;
            document.getElementById('riskMetric').textContent = results.riskTaking;
            document.getElementById('turnoverMetric').textContent = results.turnoverRisk;

            // Display financial data
            setTimeout(function() {
                var maxValue = results.grossOutput;
                
                document.getElementById('grossOutput').textContent = formatCurrency(results.grossOutput);
                document.getElementById('salaryCosts').textContent = formatCurrency(results.salaryCosts);
                document.getElementById('monitoringCosts').textContent = formatCurrency(results.monitoringCosts);
                document.getElementById('hiddenCosts').textContent = formatCurrency(results.hiddenCosts);
                document.getElementById('netValue').textContent = formatCurrency(results.netValue);

                document.getElementById('grossBar').style.width = '100%';
                document.getElementById('salaryBar').style.width = ((results.salaryCosts / maxValue) * 100) + '%';
                document.getElementById('monitoringBar').style.width = ((results.monitoringCosts / maxValue) * 100) + '%';
                document.getElementById('hiddenBar').style.width = ((results.hiddenCosts / maxValue) * 100) + '%';
            }, 500);

            // Diagnosis
            var diagnosisBox = document.getElementById('diagnosisBox');
            diagnosisBox.className = 'diagnosis-box ' + results.diagnosisType;
            document.getElementById('diagnosisTitle').textContent = results.diagnosisTitle;
            document.getElementById('diagnosisText').textContent = results.diagnosisText;
            
            var issuesList = document.getElementById('diagnosisList');
            issuesList.innerHTML = '';
            for (var i = 0; i < results.issues.length; i++) {
                var li = document.createElement('li');
                li.textContent = results.issues[i];
                issuesList.appendChild(li);
            }

            // Comparison table
            document.getElementById('compYourScore').textContent = results.productivityScore + '/100';
            document.getElementById('compYourValue').textContent = formatCurrency(results.netValue);
            document.getElementById('compYourHidden').textContent = results.hiddenCostRatio;

            // Store for later stages
            window.currentResults = results;
        }

        function formatCurrency(value) {
            if (value >= 1000000) {
                return '‚Ç¨' + (value / 1000000).toFixed(2) + 'M';
            } else if (value >= 1000) {
                return '‚Ç¨' + (value / 1000).toFixed(0) + 'K';
            }
            return '‚Ç¨' + value.toFixed(0);
        }

        function animateNumber(elementId, start, end, duration) {
            var element = document.getElementById(elementId);
            var range = end - start;
            var increment = range / (duration / 16);
            var current = start;

            var timer = setInterval(function() {
                current += increment;
                if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) {
                    current = end;
                    clearInterval(timer);
                }
                element.textContent = Math.round(current);
            }, 16);
        }

        function captureEmail() {
            var email = document.getElementById('emailInput').value;
            if (!email || !email.includes('@')) {
                alert('Please enter a valid email address');
                return;
            }

            // In production, send to backend/email service
            alert('Thank you! In production, your report would be sent to: ' + email);
            
            // Show specific issues
            showPersonalizedIssues();
        }

        function showPersonalizedIssues() {
            var results = window.currentResults;
            var issuesDiv = document.getElementById('yourIssues');
            
            var html = '<div style="background: white; padding: 20px; border-radius: 10px;">';
            for (var i = 0; i < results.issues.length; i++) {
                html += '<p style="margin: 10px 0; padding: 10px; background: #fff3cd; border-radius: 5px;">‚ö†Ô∏è ' + results.issues[i] + '</p>';
            }
            html += '</div>';
            
            issuesDiv.innerHTML = html;
        }

        function resetSimulation() {
            currentStage = 0;
            nextStage(0);
            
            // Reset all inputs
            document.getElementById('baseSalary').value = 80000;
            document.getElementById('bonus').value = 15;
            document.getElementById('pressure').value = 2;
            document.getElementById('autonomy').value = 2;
            
            document.getElementById('equity1').checked = true;
            document.getElementById('review1').checked = true;
            document.getElementById('time1').checked = true;
            document.getElementById('meeting1').checked = true;
            document.getElementById('quality2').checked = true;
            
            updateSliderValue('baseSalary', '‚Ç¨', 'K');
            updateSliderValue('bonus', '', '%');
            updatePressureLabel();
            updateAutonomyLabel();
        }

        // Initialize
        updateProgress();
    </script>
</body>
</html>
